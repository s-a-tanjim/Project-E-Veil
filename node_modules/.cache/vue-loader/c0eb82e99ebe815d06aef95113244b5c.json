{"remainingRequest":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Programs\\Project\\Project-E-Veil\\src\\components\\compose\\compose_main.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Programs\\Project\\Project-E-Veil\\src\\components\\compose\\compose_main.vue","mtime":1587468654592},{"path":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgZmlyZWJhc2UgZnJvbSAiZmlyZWJhc2UiOw0KZXhwb3J0IGRlZmF1bHQgew0KICBkYXRhOiBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gew0KICAgICAgcmVjZWl2ZXJfZW1haWw6ICIiLA0KICAgICAgc3ViamVjdDogIiIsDQogICAgICBtZXNzYWdlOiAiIiwNCiAgICAgIGVtYWlsOiAiIiwNCiAgICAgIHVzZXJuYW1lOiAiIiwNCiAgICAgIHRpbWU6ICIiLA0KICAgICAgZGF0ZTogIiIsDQogICAgICBjYW5TZW5kRmxhZzogZmFsc2UsDQogICAgICBtYWlsVHlwZTogIiIsDQogICAgICBjb3VudGVySW5jRmxhZzogZmFsc2UsDQogICAgICBzZW5kX2NvdW50OiAwDQogICAgfTsNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIHNlbmROb3JtYWxFbWFpbChldmVudCkgew0KICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgIHRoaXMubWFpbFR5cGUgPSAiTm9ybWFsIjsNCiAgICAgIHRoaXMuc2VuZEVtYWlsKCk7DQogICAgfSwNCiAgICBzZW5kRW1haWxBbm9ueW1vdXNseShldmVudCkgew0KICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgIHRoaXMubWFpbFR5cGUgPSAiQW5vbnltb3VzIjsNCiAgICAgIHRoaXMuc2VuZEVtYWlsKCk7DQogICAgfSwNCiAgICBzZW5kRW1haWwoKSB7DQogICAgICBpZiAoDQogICAgICAgIHRoaXMucmVjZWl2ZXJfZW1haWwgPT0gIiIgfHwNCiAgICAgICAgdGhpcy5zdWJqZWN0ID09ICIiIHx8DQogICAgICAgIHRoaXMubWVzc2FnZSA9PSAiIg0KICAgICAgKSB7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbXB0eUZpZWxkRXJyb3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbXB0eUZpZWxkRXJyb3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KDQogICAgICAgIGlmICh0aGlzLnZlcmlmeVNlbmRlcigpID09IGZhbHNlKSB7DQogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImludmFsaWRFbWFpbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICB2ZXJpZnlTZW5kZXIoKSB7DQogICAgICBpZiAodGhpcy5yZWNlaXZlcl9lbWFpbC5sZW5ndGggPCAxMSkgcmV0dXJuIGZhbHNlOw0KICAgICAgaWYgKCF0aGlzLnJlY2VpdmVyX2VtYWlsLmluY2x1ZGVzKCJAZXZlaWwuY29tIikpIHJldHVybiBmYWxzZTsNCiAgICAgIHZhciB0b191aWQgPSB0aGlzLnJlY2VpdmVyX2VtYWlsLnN1YnN0cmluZygNCiAgICAgICAgMCwNCiAgICAgICAgdGhpcy5yZWNlaXZlcl9lbWFpbC5sZW5ndGggLSAxMA0KICAgICAgKTsNCiAgICAgIHZhciByZWYgPSAidXNlci8iICsgdG9fdWlkOw0KICAgICAgdmFyIHVzZXJSZWYgPSBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZihyZWYpOw0KICAgICAgdXNlclJlZi5vbigNCiAgICAgICAgInZhbHVlIiwNCiAgICAgICAgZGF0YSA9PiB7DQogICAgICAgICAgdmFyIGFsbGRhdGEgPSBkYXRhLnZhbCgpOw0KICAgICAgICAgIGlmIChhbGxkYXRhID09PSBudWxsIHx8IGFsbGRhdGEgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImludmFsaWRFbWFpbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW52YWxpZEVtYWlsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgICAgICAgICAgIHRoaXMuY2FuU2VuZEZsYWcgPSB0cnVlOw0KICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgZXJyVXNlckRhdGEgPT4gew0KICAgICAgICAgIGNvbnNvbGUubG9nKGVyclVzZXJEYXRhKTsNCiAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICk7DQogICAgfSwNCiAgICB1cGRhdGVSZWNlaXZlcigpIHsNCiAgICAgIC8vVXBkYXRlIHJlY2VpdmVyIERCDQogICAgICB2YXIgdG9fdWlkID0gdGhpcy5yZWNlaXZlcl9lbWFpbC5zdWJzdHJpbmcoDQogICAgICAgIDAsDQogICAgICAgIHRoaXMucmVjZWl2ZXJfZW1haWwubGVuZ3RoIC0gMTANCiAgICAgICk7DQogICAgICB2YXIgcmVmLCB0b191c2VyUmVmLCBuZXdFbWFpbFJlZjsNCiAgICAgIGlmICh0aGlzLm1haWxUeXBlID09ICJOb3JtYWwiKSB7DQogICAgICAgIHJlZiA9ICJlbWFpbHMvIiArIHRvX3VpZCArICIvcmVjZWl2ZWQiOw0KICAgICAgICB0b191c2VyUmVmID0gZmlyZWJhc2UuZGF0YWJhc2UoKS5yZWYocmVmKTsNCiAgICAgICAgbmV3RW1haWxSZWYgPSB0b191c2VyUmVmLnB1c2goKTsNCiAgICAgICAgbmV3RW1haWxSZWYuc2V0KHsNCiAgICAgICAgICBmcm9tOiB0aGlzLmVtYWlsLA0KICAgICAgICAgIHN1YmplY3Q6IHRoaXMuc3ViamVjdCwNCiAgICAgICAgICBtZXNzYWdlOiB0aGlzLm1lc3NhZ2UsDQogICAgICAgICAgYmluOiAiMCIsDQogICAgICAgICAgc2VlbjogIjAiLA0KICAgICAgICAgIHRpbWU6IHRoaXMudGltZSwNCiAgICAgICAgICBkYXRlOiB0aGlzLmRhdGUNCiAgICAgICAgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZWYgPSAiZW1haWxzLyIgKyB0b191aWQgKyAiL3ZlaWxib3giOw0KICAgICAgICB0b191c2VyUmVmID0gZmlyZWJhc2UuZGF0YWJhc2UoKS5yZWYocmVmKTsNCiAgICAgICAgbmV3RW1haWxSZWYgPSB0b191c2VyUmVmLnB1c2goKTsNCiAgICAgICAgbmV3RW1haWxSZWYuc2V0KHsNCiAgICAgICAgICBmcm9tOiAiQW5vbnltb3VzIiwNCiAgICAgICAgICBzdWJqZWN0OiB0aGlzLnN1YmplY3QsDQogICAgICAgICAgbWVzc2FnZTogdGhpcy5tZXNzYWdlLA0KICAgICAgICAgIGJpbjogIjAiLA0KICAgICAgICAgIHNlZW46ICIwIiwNCiAgICAgICAgICB0aW1lOiB0aGlzLnRpbWUsDQogICAgICAgICAgZGF0ZTogdGhpcy5kYXRlDQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0sDQogICAgZ2V0VGltZSgpIHsNCiAgICAgIHZhciB0b2RheSA9IG5ldyBEYXRlKCk7DQogICAgICB0aGlzLnRpbWUgPQ0KICAgICAgICB0b2RheS5nZXRIb3VycygpICsgIjoiICsgdG9kYXkuZ2V0TWludXRlcygpICsgIjoiICsgdG9kYXkuZ2V0U2Vjb25kcygpOw0KICAgICAgdGhpcy5kYXRlID0NCiAgICAgICAgdG9kYXkuZ2V0RGF0ZSgpICsNCiAgICAgICAgIi0iICsNCiAgICAgICAgKHRvZGF5LmdldE1vbnRoKCkgKyAxKSArDQogICAgICAgICItIiArDQogICAgICAgIHRvZGF5LmdldEZ1bGxZZWFyKCk7DQogICAgfSwNCiAgICB1cGRhdGVTZW5kZXIoKSB7DQogICAgICAvL1VwZGF0ZSBzZW5kZXIgREINCiAgICAgIHZhciByZWYgPSAiZW1haWxzLyIgKyB0aGlzLnVzZXJuYW1lICsgIi9zZW50IjsNCiAgICAgIHZhciB1c2VyUmVmID0gZmlyZWJhc2UuZGF0YWJhc2UoKS5yZWYocmVmKTsNCiAgICAgIHZhciBuZXdFbWFpbFJlZiA9IHVzZXJSZWYucHVzaCgpOw0KICAgICAgbmV3RW1haWxSZWYuc2V0KHsNCiAgICAgICAgdG86IHRoaXMucmVjZWl2ZXJfZW1haWwsDQogICAgICAgIHN1YmplY3Q6IHRoaXMuc3ViamVjdCwNCiAgICAgICAgbWVzc2FnZTogdGhpcy5tZXNzYWdlLA0KICAgICAgICBiaW46ICIwIiwNCiAgICAgICAgdGltZTogdGhpcy50aW1lLA0KICAgICAgICBkYXRlOiB0aGlzLmRhdGUNCiAgICAgIH0pOw0KICAgICAgLy9pbmNyZWFzZSBzZW5kIGNvdW50IG9mIHNlbmRlcg0KICAgICAgLy9HZXQgY3VycmVudCBzZW5kRW1haWwgY291bnQNCiAgICAgIHJlZiA9ICJ1c2VyLyIgKyB0aGlzLnVzZXJuYW1lOw0KICAgICAgdXNlclJlZiA9IGZpcmViYXNlLmRhdGFiYXNlKCkucmVmKHJlZik7DQogICAgICB1c2VyUmVmLm9uKA0KICAgICAgICAidmFsdWUiLA0KICAgICAgICBkYXRhID0+IHsNCiAgICAgICAgICB0aGlzLnNlbmRfY291bnQgPSBkYXRhLnZhbCgpLnNlbnRfZW1haWw7DQogICAgICAgICAgdGhpcy5jb3VudGVySW5jRmxhZyA9IHRydWU7DQogICAgICAgIH0sDQogICAgICAgIGVyciA9PiB7DQogICAgICAgICAgY29uc29sZS5sb2coZXJyKTsNCiAgICAgICAgfQ0KICAgICAgKTsNCiAgICB9LA0KICAgIHJlc2V0Rm9ybSgpIHsNCiAgICAgIHRoaXMucmVjZWl2ZXJfZW1haWwgPSAiIjsNCiAgICAgIHRoaXMuc3ViamVjdCA9ICIiOw0KICAgICAgdGhpcy5tZXNzYWdlID0gIiI7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3VjY2Vzc2Z1bGx5LXNlbnQtbW9kYWwtYnRuIikuY2xpY2soKTsNCiAgICB9DQogIH0sDQogIGNyZWF0ZWQoKSB7DQogICAgdGhpcy5lbWFpbCA9IGZpcmViYXNlLmF1dGgoKS5jdXJyZW50VXNlci5lbWFpbDsNCiAgICB0aGlzLnVzZXJuYW1lID0gdGhpcy5lbWFpbC5zdWJzdHJpbmcoMCwgdGhpcy5lbWFpbC5sZW5ndGggLSAxMCk7DQogIH0sDQogIHdhdGNoOiB7DQogICAgY2FuU2VuZEZsYWc6IGZ1bmN0aW9uKCkgew0KICAgICAgaWYgKHRoaXMuY2FuU2VuZEZsYWcpIHsNCiAgICAgICAgdGhpcy5nZXRUaW1lKCk7DQogICAgICAgIHRoaXMudXBkYXRlUmVjZWl2ZXIoKTsNCiAgICAgICAgdGhpcy51cGRhdGVTZW5kZXIoKTsNCiAgICAgICAgdGhpcy5yZXNldEZvcm0oKTsNCiAgICAgIH0NCiAgICAgIHRoaXMuY2FuU2VuZEZsYWcgPSBmYWxzZTsNCiAgICB9LA0KICAgIGNvdW50ZXJJbmNGbGFnOiBmdW5jdGlvbigpIHsNCiAgICAgIGlmICh0aGlzLmNvdW50ZXJJbmNGbGFnKSB7DQogICAgICAgIHZhciByZWYgPSAidXNlci8iICsgdGhpcy51c2VybmFtZTsNCiAgICAgICAgdGhpcy5zZW5kX2NvdW50Kys7DQogICAgICAgIHZhciBmcm9tX3VzZXJSZWZfY291bnQgPSBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZihyZWYpOw0KICAgICAgICBmcm9tX3VzZXJSZWZfY291bnQudXBkYXRlKHsNCiAgICAgICAgICBzZW50X2VtYWlsOiB0aGlzLnNlbmRfY291bnQNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgICB0aGlzLmNvdW50ZXJJbmNGbGFnID0gZmFsc2U7DQogICAgfQ0KICB9DQp9Ow0K"},{"version":3,"sources":["compose_main.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"compose_main.vue","sourceRoot":"src/components/compose","sourcesContent":["<template>\r\n  <div>\r\n    <!-- Topbar will be here -->\r\n    <component v-bind:is=\"'Navbar'\"></component>\r\n    <div class=\"wrapper-body\">\r\n      <!-- Sidebar -->\r\n      <component v-bind:is=\"'Sidebar'\"></component>\r\n      <div class=\"body-container\">\r\n        <div class=\"row\">\r\n          <div class=\"col-12 col-sm-12 col-md-10 col-lg-8 col-xl-8\">\r\n            <form class=\"compose-container\">\r\n              <div class=\"row justify-content-center\">\r\n                <div\r\n                  class=\"col-md-6 col-lg-6 col-xl-6 error-msg\"\r\n                  id=\"emptyFieldError\"\r\n                  style=\"text-align:center;\"\r\n                >Field can't be empty!</div>\r\n              </div>\r\n              <div class=\"form-group\">\r\n                <label for=\"receiver_email\">To</label>\r\n                <input\r\n                  type=\"email\"\r\n                  class=\"form-control\"\r\n                  id=\"receiver_email\"\r\n                  v-model=\"receiver_email\"\r\n                  placeholder=\"email@eveil.com\"\r\n                />\r\n                <small id=\"invalidEmail\" class=\"error-msg\">Invalid Email!</small>\r\n              </div>\r\n              <div class=\"form-group\">\r\n                <input type=\"text\" class=\"form-control\" v-model=\"subject\" placeholder=\"Subject\" />\r\n              </div>\r\n              <div class=\"form-group\">\r\n                <textarea\r\n                  type=\"text\"\r\n                  class=\"form-control\"\r\n                  rows=\"4\"\r\n                  v-model=\"message\"\r\n                  placeholder=\"Enter your message\"\r\n                />\r\n              </div>\r\n              <div class=\"row\">\r\n                <div class=\"col-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 left-btn-container\">\r\n                  <button class=\"eveilbtn\" type=\"submit\" @click=\"sendNormalEmail\">Send</button>\r\n                </div>\r\n                <div class=\"col-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 right-btn-container\">\r\n                  <button\r\n                    class=\"eveilbtn\"\r\n                    type=\"submit\"\r\n                    @click=\"sendEmailAnonymously\"\r\n                  >Send Anonymously</button>\r\n                </div>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Button trigger modal -->\r\n    <button\r\n      id=\"successfully-sent-modal-btn\"\r\n      style=\"display:none;\"\r\n      data-toggle=\"modal\"\r\n      data-target=\"#successfully-sent-modal\"\r\n    ></button>\r\n\r\n    <!-- Modal -->\r\n    <div\r\n      class=\"modal fade\"\r\n      id=\"successfully-sent-modal\"\r\n      tabindex=\"-1\"\r\n      role=\"dialog\"\r\n      aria-labelledby=\"successfully-sent-modalLabel\"\r\n      aria-hidden=\"true\"\r\n    >\r\n      <div class=\"modal-dialog\" role=\"document\">\r\n        <div class=\"modal-content success-color\">\r\n          <div class=\"modal-header\" style=\"border-bottom:none;\">\r\n            <h5 class=\"modal-title\" id=\"successfully-sent-modalLabel\">Email Sent Successfully!</h5>\r\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n              <span aria-hidden=\"true\">&times;</span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport firebase from \"firebase\";\r\nexport default {\r\n  data: function() {\r\n    return {\r\n      receiver_email: \"\",\r\n      subject: \"\",\r\n      message: \"\",\r\n      email: \"\",\r\n      username: \"\",\r\n      time: \"\",\r\n      date: \"\",\r\n      canSendFlag: false,\r\n      mailType: \"\",\r\n      counterIncFlag: false,\r\n      send_count: 0\r\n    };\r\n  },\r\n  methods: {\r\n    sendNormalEmail(event) {\r\n      event.preventDefault();\r\n      this.mailType = \"Normal\";\r\n      this.sendEmail();\r\n    },\r\n    sendEmailAnonymously(event) {\r\n      event.preventDefault();\r\n      this.mailType = \"Anonymous\";\r\n      this.sendEmail();\r\n    },\r\n    sendEmail() {\r\n      if (\r\n        this.receiver_email == \"\" ||\r\n        this.subject == \"\" ||\r\n        this.message == \"\"\r\n      ) {\r\n        document.getElementById(\"emptyFieldError\").style.display = \"block\";\r\n      } else {\r\n        document.getElementById(\"emptyFieldError\").style.display = \"none\";\r\n\r\n        if (this.verifySender() == false) {\r\n          document.getElementById(\"invalidEmail\").style.display = \"block\";\r\n        }\r\n      }\r\n    },\r\n    verifySender() {\r\n      if (this.receiver_email.length < 11) return false;\r\n      if (!this.receiver_email.includes(\"@eveil.com\")) return false;\r\n      var to_uid = this.receiver_email.substring(\r\n        0,\r\n        this.receiver_email.length - 10\r\n      );\r\n      var ref = \"user/\" + to_uid;\r\n      var userRef = firebase.database().ref(ref);\r\n      userRef.on(\r\n        \"value\",\r\n        data => {\r\n          var alldata = data.val();\r\n          if (alldata === null || alldata === undefined) {\r\n            document.getElementById(\"invalidEmail\").style.display = \"block\";\r\n            return;\r\n          } else {\r\n            document.getElementById(\"invalidEmail\").style.display = \"none\";\r\n            this.canSendFlag = true;\r\n          }\r\n        },\r\n        errUserData => {\r\n          console.log(errUserData);\r\n          return false;\r\n        }\r\n      );\r\n    },\r\n    updateReceiver() {\r\n      //Update receiver DB\r\n      var to_uid = this.receiver_email.substring(\r\n        0,\r\n        this.receiver_email.length - 10\r\n      );\r\n      var ref, to_userRef, newEmailRef;\r\n      if (this.mailType == \"Normal\") {\r\n        ref = \"emails/\" + to_uid + \"/received\";\r\n        to_userRef = firebase.database().ref(ref);\r\n        newEmailRef = to_userRef.push();\r\n        newEmailRef.set({\r\n          from: this.email,\r\n          subject: this.subject,\r\n          message: this.message,\r\n          bin: \"0\",\r\n          seen: \"0\",\r\n          time: this.time,\r\n          date: this.date\r\n        });\r\n      } else {\r\n        ref = \"emails/\" + to_uid + \"/veilbox\";\r\n        to_userRef = firebase.database().ref(ref);\r\n        newEmailRef = to_userRef.push();\r\n        newEmailRef.set({\r\n          from: \"Anonymous\",\r\n          subject: this.subject,\r\n          message: this.message,\r\n          bin: \"0\",\r\n          seen: \"0\",\r\n          time: this.time,\r\n          date: this.date\r\n        });\r\n      }\r\n    },\r\n    getTime() {\r\n      var today = new Date();\r\n      this.time =\r\n        today.getHours() + \":\" + today.getMinutes() + \":\" + today.getSeconds();\r\n      this.date =\r\n        today.getDate() +\r\n        \"-\" +\r\n        (today.getMonth() + 1) +\r\n        \"-\" +\r\n        today.getFullYear();\r\n    },\r\n    updateSender() {\r\n      //Update sender DB\r\n      var ref = \"emails/\" + this.username + \"/sent\";\r\n      var userRef = firebase.database().ref(ref);\r\n      var newEmailRef = userRef.push();\r\n      newEmailRef.set({\r\n        to: this.receiver_email,\r\n        subject: this.subject,\r\n        message: this.message,\r\n        bin: \"0\",\r\n        time: this.time,\r\n        date: this.date\r\n      });\r\n      //increase send count of sender\r\n      //Get current sendEmail count\r\n      ref = \"user/\" + this.username;\r\n      userRef = firebase.database().ref(ref);\r\n      userRef.on(\r\n        \"value\",\r\n        data => {\r\n          this.send_count = data.val().sent_email;\r\n          this.counterIncFlag = true;\r\n        },\r\n        err => {\r\n          console.log(err);\r\n        }\r\n      );\r\n    },\r\n    resetForm() {\r\n      this.receiver_email = \"\";\r\n      this.subject = \"\";\r\n      this.message = \"\";\r\n      document.getElementById(\"successfully-sent-modal-btn\").click();\r\n    }\r\n  },\r\n  created() {\r\n    this.email = firebase.auth().currentUser.email;\r\n    this.username = this.email.substring(0, this.email.length - 10);\r\n  },\r\n  watch: {\r\n    canSendFlag: function() {\r\n      if (this.canSendFlag) {\r\n        this.getTime();\r\n        this.updateReceiver();\r\n        this.updateSender();\r\n        this.resetForm();\r\n      }\r\n      this.canSendFlag = false;\r\n    },\r\n    counterIncFlag: function() {\r\n      if (this.counterIncFlag) {\r\n        var ref = \"user/\" + this.username;\r\n        this.send_count++;\r\n        var from_userRef_count = firebase.database().ref(ref);\r\n        from_userRef_count.update({\r\n          sent_email: this.send_count\r\n        });\r\n      }\r\n      this.counterIncFlag = false;\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.compose-container {\r\n  border: 1px solid #111;\r\n  border-radius: 5px;\r\n  padding: 80px 60px;\r\n}\r\n.form-group {\r\n  margin-bottom: 2rem;\r\n}\r\nlabel {\r\n  margin-bottom: 0px;\r\n}\r\n.left-btn-container {\r\n  text-align: left;\r\n}\r\n.right-btn-container {\r\n  text-align: right;\r\n}\r\n@media screen and (max-width: 767px) {\r\n  .compose-container {\r\n    padding: 60px 30px;\r\n  }\r\n  .left-btn-container,\r\n  .right-btn-container {\r\n    text-align: center;\r\n    margin: 10px auto;\r\n  }\r\n}\r\n</style>"]}]}