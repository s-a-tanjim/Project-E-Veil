{"remainingRequest":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Programs\\Project\\Project-E-Veil\\src\\components\\compose\\compose_main.vue?vue&type=style&index=0&id=346ca433&scoped=true&lang=css&","dependencies":[{"path":"D:\\Programs\\Project\\Project-E-Veil\\src\\components\\compose\\compose_main.vue","mtime":1587468654592},{"path":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLmNvbXBvc2UtY29udGFpbmVyIHsNCiAgYm9yZGVyOiAxcHggc29saWQgIzExMTsNCiAgYm9yZGVyLXJhZGl1czogNXB4Ow0KICBwYWRkaW5nOiA4MHB4IDYwcHg7DQp9DQouZm9ybS1ncm91cCB7DQogIG1hcmdpbi1ib3R0b206IDJyZW07DQp9DQpsYWJlbCB7DQogIG1hcmdpbi1ib3R0b206IDBweDsNCn0NCi5sZWZ0LWJ0bi1jb250YWluZXIgew0KICB0ZXh0LWFsaWduOiBsZWZ0Ow0KfQ0KLnJpZ2h0LWJ0bi1jb250YWluZXIgew0KICB0ZXh0LWFsaWduOiByaWdodDsNCn0NCkBtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDc2N3B4KSB7DQogIC5jb21wb3NlLWNvbnRhaW5lciB7DQogICAgcGFkZGluZzogNjBweCAzMHB4Ow0KICB9DQogIC5sZWZ0LWJ0bi1jb250YWluZXIsDQogIC5yaWdodC1idG4tY29udGFpbmVyIHsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgbWFyZ2luOiAxMHB4IGF1dG87DQogIH0NCn0NCg=="},{"version":3,"sources":["compose_main.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"compose_main.vue","sourceRoot":"src/components/compose","sourcesContent":["<template>\r\n  <div>\r\n    <!-- Topbar will be here -->\r\n    <component v-bind:is=\"'Navbar'\"></component>\r\n    <div class=\"wrapper-body\">\r\n      <!-- Sidebar -->\r\n      <component v-bind:is=\"'Sidebar'\"></component>\r\n      <div class=\"body-container\">\r\n        <div class=\"row\">\r\n          <div class=\"col-12 col-sm-12 col-md-10 col-lg-8 col-xl-8\">\r\n            <form class=\"compose-container\">\r\n              <div class=\"row justify-content-center\">\r\n                <div\r\n                  class=\"col-md-6 col-lg-6 col-xl-6 error-msg\"\r\n                  id=\"emptyFieldError\"\r\n                  style=\"text-align:center;\"\r\n                >Field can't be empty!</div>\r\n              </div>\r\n              <div class=\"form-group\">\r\n                <label for=\"receiver_email\">To</label>\r\n                <input\r\n                  type=\"email\"\r\n                  class=\"form-control\"\r\n                  id=\"receiver_email\"\r\n                  v-model=\"receiver_email\"\r\n                  placeholder=\"email@eveil.com\"\r\n                />\r\n                <small id=\"invalidEmail\" class=\"error-msg\">Invalid Email!</small>\r\n              </div>\r\n              <div class=\"form-group\">\r\n                <input type=\"text\" class=\"form-control\" v-model=\"subject\" placeholder=\"Subject\" />\r\n              </div>\r\n              <div class=\"form-group\">\r\n                <textarea\r\n                  type=\"text\"\r\n                  class=\"form-control\"\r\n                  rows=\"4\"\r\n                  v-model=\"message\"\r\n                  placeholder=\"Enter your message\"\r\n                />\r\n              </div>\r\n              <div class=\"row\">\r\n                <div class=\"col-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 left-btn-container\">\r\n                  <button class=\"eveilbtn\" type=\"submit\" @click=\"sendNormalEmail\">Send</button>\r\n                </div>\r\n                <div class=\"col-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 right-btn-container\">\r\n                  <button\r\n                    class=\"eveilbtn\"\r\n                    type=\"submit\"\r\n                    @click=\"sendEmailAnonymously\"\r\n                  >Send Anonymously</button>\r\n                </div>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Button trigger modal -->\r\n    <button\r\n      id=\"successfully-sent-modal-btn\"\r\n      style=\"display:none;\"\r\n      data-toggle=\"modal\"\r\n      data-target=\"#successfully-sent-modal\"\r\n    ></button>\r\n\r\n    <!-- Modal -->\r\n    <div\r\n      class=\"modal fade\"\r\n      id=\"successfully-sent-modal\"\r\n      tabindex=\"-1\"\r\n      role=\"dialog\"\r\n      aria-labelledby=\"successfully-sent-modalLabel\"\r\n      aria-hidden=\"true\"\r\n    >\r\n      <div class=\"modal-dialog\" role=\"document\">\r\n        <div class=\"modal-content success-color\">\r\n          <div class=\"modal-header\" style=\"border-bottom:none;\">\r\n            <h5 class=\"modal-title\" id=\"successfully-sent-modalLabel\">Email Sent Successfully!</h5>\r\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n              <span aria-hidden=\"true\">&times;</span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport firebase from \"firebase\";\r\nexport default {\r\n  data: function() {\r\n    return {\r\n      receiver_email: \"\",\r\n      subject: \"\",\r\n      message: \"\",\r\n      email: \"\",\r\n      username: \"\",\r\n      time: \"\",\r\n      date: \"\",\r\n      canSendFlag: false,\r\n      mailType: \"\",\r\n      counterIncFlag: false,\r\n      send_count: 0\r\n    };\r\n  },\r\n  methods: {\r\n    sendNormalEmail(event) {\r\n      event.preventDefault();\r\n      this.mailType = \"Normal\";\r\n      this.sendEmail();\r\n    },\r\n    sendEmailAnonymously(event) {\r\n      event.preventDefault();\r\n      this.mailType = \"Anonymous\";\r\n      this.sendEmail();\r\n    },\r\n    sendEmail() {\r\n      if (\r\n        this.receiver_email == \"\" ||\r\n        this.subject == \"\" ||\r\n        this.message == \"\"\r\n      ) {\r\n        document.getElementById(\"emptyFieldError\").style.display = \"block\";\r\n      } else {\r\n        document.getElementById(\"emptyFieldError\").style.display = \"none\";\r\n\r\n        if (this.verifySender() == false) {\r\n          document.getElementById(\"invalidEmail\").style.display = \"block\";\r\n        }\r\n      }\r\n    },\r\n    verifySender() {\r\n      if (this.receiver_email.length < 11) return false;\r\n      if (!this.receiver_email.includes(\"@eveil.com\")) return false;\r\n      var to_uid = this.receiver_email.substring(\r\n        0,\r\n        this.receiver_email.length - 10\r\n      );\r\n      var ref = \"user/\" + to_uid;\r\n      var userRef = firebase.database().ref(ref);\r\n      userRef.on(\r\n        \"value\",\r\n        data => {\r\n          var alldata = data.val();\r\n          if (alldata === null || alldata === undefined) {\r\n            document.getElementById(\"invalidEmail\").style.display = \"block\";\r\n            return;\r\n          } else {\r\n            document.getElementById(\"invalidEmail\").style.display = \"none\";\r\n            this.canSendFlag = true;\r\n          }\r\n        },\r\n        errUserData => {\r\n          console.log(errUserData);\r\n          return false;\r\n        }\r\n      );\r\n    },\r\n    updateReceiver() {\r\n      //Update receiver DB\r\n      var to_uid = this.receiver_email.substring(\r\n        0,\r\n        this.receiver_email.length - 10\r\n      );\r\n      var ref, to_userRef, newEmailRef;\r\n      if (this.mailType == \"Normal\") {\r\n        ref = \"emails/\" + to_uid + \"/received\";\r\n        to_userRef = firebase.database().ref(ref);\r\n        newEmailRef = to_userRef.push();\r\n        newEmailRef.set({\r\n          from: this.email,\r\n          subject: this.subject,\r\n          message: this.message,\r\n          bin: \"0\",\r\n          seen: \"0\",\r\n          time: this.time,\r\n          date: this.date\r\n        });\r\n      } else {\r\n        ref = \"emails/\" + to_uid + \"/veilbox\";\r\n        to_userRef = firebase.database().ref(ref);\r\n        newEmailRef = to_userRef.push();\r\n        newEmailRef.set({\r\n          from: \"Anonymous\",\r\n          subject: this.subject,\r\n          message: this.message,\r\n          bin: \"0\",\r\n          seen: \"0\",\r\n          time: this.time,\r\n          date: this.date\r\n        });\r\n      }\r\n    },\r\n    getTime() {\r\n      var today = new Date();\r\n      this.time =\r\n        today.getHours() + \":\" + today.getMinutes() + \":\" + today.getSeconds();\r\n      this.date =\r\n        today.getDate() +\r\n        \"-\" +\r\n        (today.getMonth() + 1) +\r\n        \"-\" +\r\n        today.getFullYear();\r\n    },\r\n    updateSender() {\r\n      //Update sender DB\r\n      var ref = \"emails/\" + this.username + \"/sent\";\r\n      var userRef = firebase.database().ref(ref);\r\n      var newEmailRef = userRef.push();\r\n      newEmailRef.set({\r\n        to: this.receiver_email,\r\n        subject: this.subject,\r\n        message: this.message,\r\n        bin: \"0\",\r\n        time: this.time,\r\n        date: this.date\r\n      });\r\n      //increase send count of sender\r\n      //Get current sendEmail count\r\n      ref = \"user/\" + this.username;\r\n      userRef = firebase.database().ref(ref);\r\n      userRef.on(\r\n        \"value\",\r\n        data => {\r\n          this.send_count = data.val().sent_email;\r\n          this.counterIncFlag = true;\r\n        },\r\n        err => {\r\n          console.log(err);\r\n        }\r\n      );\r\n    },\r\n    resetForm() {\r\n      this.receiver_email = \"\";\r\n      this.subject = \"\";\r\n      this.message = \"\";\r\n      document.getElementById(\"successfully-sent-modal-btn\").click();\r\n    }\r\n  },\r\n  created() {\r\n    this.email = firebase.auth().currentUser.email;\r\n    this.username = this.email.substring(0, this.email.length - 10);\r\n  },\r\n  watch: {\r\n    canSendFlag: function() {\r\n      if (this.canSendFlag) {\r\n        this.getTime();\r\n        this.updateReceiver();\r\n        this.updateSender();\r\n        this.resetForm();\r\n      }\r\n      this.canSendFlag = false;\r\n    },\r\n    counterIncFlag: function() {\r\n      if (this.counterIncFlag) {\r\n        var ref = \"user/\" + this.username;\r\n        this.send_count++;\r\n        var from_userRef_count = firebase.database().ref(ref);\r\n        from_userRef_count.update({\r\n          sent_email: this.send_count\r\n        });\r\n      }\r\n      this.counterIncFlag = false;\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.compose-container {\r\n  border: 1px solid #111;\r\n  border-radius: 5px;\r\n  padding: 80px 60px;\r\n}\r\n.form-group {\r\n  margin-bottom: 2rem;\r\n}\r\nlabel {\r\n  margin-bottom: 0px;\r\n}\r\n.left-btn-container {\r\n  text-align: left;\r\n}\r\n.right-btn-container {\r\n  text-align: right;\r\n}\r\n@media screen and (max-width: 767px) {\r\n  .compose-container {\r\n    padding: 60px 30px;\r\n  }\r\n  .left-btn-container,\r\n  .right-btn-container {\r\n    text-align: center;\r\n    margin: 10px auto;\r\n  }\r\n}\r\n</style>"]}]}