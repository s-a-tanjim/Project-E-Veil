{"remainingRequest":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Programs\\Project\\Project-E-Veil\\src\\components\\binbox\\binbox_main.vue?vue&type=style&index=0&id=0b478d19&scoped=true&lang=css&","dependencies":[{"path":"D:\\Programs\\Project\\Project-E-Veil\\src\\components\\binbox\\binbox_main.vue","mtime":1587572020266},{"path":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Programs\\Project\\Project-E-Veil\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQouZXZlaWxidG4gew0KICBwYWRkaW5nOiA1cHggMjBweDsNCn0NCi5tc2ctcmVjb3Zlci1idG4gew0KICByaWdodDogOTBweDsNCn0NCg=="},{"version":3,"sources":["binbox_main.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyQA;AACA;AACA;AACA;AACA;AACA","file":"binbox_main.vue","sourceRoot":"src/components/binbox","sourcesContent":["<template>\r\n  <div>\r\n    <!-- Topbar will be here -->\r\n    <component v-bind:is=\"'Navbar'\"></component>\r\n    <div class=\"wrapper-body\">\r\n      <!-- Sidebar -->\r\n      <component v-bind:is=\"'Sidebar'\"></component>\r\n      <div class=\"body-container\">\r\n        <div class=\"base-demo\">\r\n          <vue-table-dynamic\r\n            :params=\"params\"\r\n            @selection-change=\"onSelectionChange\"\r\n            v-on:row-click=\"getClickedRow\"\r\n            ref=\"table\"\r\n          ></vue-table-dynamic>\r\n          <div style=\"text-align:center;\" v-if=\"noDataFoundFlag==true\">No data found</div>\r\n        </div>\r\n        <div style=\"text-align:right;color:gray;margin-top:30px;\">\r\n          <p>Last updated at {{ updateTime }}</p>\r\n        </div>\r\n\r\n        <button v-if=\"selectMsgFlag\" class=\"msg-delete-btn msg-recover-btn\" @click=\"recoverMsg\">\r\n          <i class=\"fas fa-redo\"></i>\r\n        </button>\r\n        <button\r\n          v-if=\"selectMsgFlag\"\r\n          class=\"msg-delete-btn\"\r\n          data-toggle=\"modal\"\r\n          data-target=\"#deleteEmailsModal\"\r\n        >\r\n          <i class=\"fas fa-trash-alt\"></i>\r\n        </button>\r\n\r\n        <!-- Modal -->\r\n        <div\r\n          class=\"modal fade\"\r\n          id=\"deleteEmailsModal\"\r\n          tabindex=\"-1\"\r\n          role=\"dialog\"\r\n          aria-labelledby=\"deleteEmailsModalLabel\"\r\n          aria-hidden=\"true\"\r\n        >\r\n          <div class=\"modal-dialog\" role=\"document\">\r\n            <div class=\"modal-content\">\r\n              <div class=\"modal-header\">\r\n                <h5\r\n                  class=\"modal-title\"\r\n                  id=\"deleteEmailsModalLabel\"\r\n                  style=\"color: #ba2937;\"\r\n                >Delete email permanently</h5>\r\n                <button\r\n                  type=\"button\"\r\n                  class=\"close\"\r\n                  id=\"closebtn-delete-modal\"\r\n                  data-dismiss=\"modal\"\r\n                  aria-label=\"Close\"\r\n                >\r\n                  <span aria-hidden=\"true\">&times;</span>\r\n                </button>\r\n              </div>\r\n              <div class=\"modal-body\">\r\n                <p>Are you sure you want to delete selected items?</p>\r\n                <p>\r\n                  <i class=\"fas fa-exclamation-triangle\" style=\"margin-right:10px;\"></i>All selected data will be deleted permanently!\r\n                </p>\r\n              </div>\r\n              <div class=\"modal-footer\">\r\n                <button type=\"button\" class=\"eveilbtn\" data-dismiss=\"modal\">No</button>\r\n                <button type=\"button\" class=\"eveilbtn\" @click=\"deleteMsg\">Yes</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport firebase from \"firebase\";\r\nimport VueTableDynamic from \"vue-table-dynamic\";\r\nexport default {\r\n  data: function() {\r\n    return {\r\n      username: \"\",\r\n      email: \"\",\r\n      selectMsgFlag: false,\r\n      noDataFoundFlag: null,\r\n      updateTime: \" \",\r\n      params: {\r\n        data: [[\"From/To\", \"Title\", \"Description\", \"id\", \"src\"]],\r\n        header: \"row\",\r\n        stripe: true,\r\n        showCheck: true,\r\n        enableSearch: true,\r\n        sort: [0, 1],\r\n        pagination: true,\r\n        pageSize: 10,\r\n        pageSizes: [10, 20, 50],\r\n        columnWidth: [\r\n          { column: 0, width: \"20%\" },\r\n          { column: 1, width: \"30%\" },\r\n          { column: 2, width: \"50%\" },\r\n          { column: 3, width: \"0%\" },\r\n          { column: 4, width: \"0%\" }\r\n        ]\r\n      }\r\n    };\r\n  },\r\n  components: { VueTableDynamic },\r\n  methods: {\r\n    getClickedRow(index, data) {\r\n      //console.log(\"getClickedRow  :\", index, data);\r\n      if (index == 0) return;\r\n      var url = \"/message/\" + data[3];\r\n      if (data[4] == \"received\") url += \"/inbox\";\r\n      if (data[4] == \"sent\") url += \"/outbox\";\r\n      if (data[4] == \"veilbox\") url += \"/veilbox\";\r\n      this.$router.push(url);\r\n    },\r\n    getDataFromFirebase(from) {\r\n      var refUser = \"emails/\" + this.username + \"/\" + from;\r\n      var emailsRef = firebase.database().ref(refUser);\r\n      emailsRef.on(\r\n        \"value\",\r\n        data => {\r\n          var alldata = data.val();\r\n          if (alldata != null && alldata != undefined) {\r\n            var keys = Object.keys(alldata);\r\n            keys.reverse();\r\n            keys.forEach(index => {\r\n              if (alldata[index].bin == \"1\") {\r\n                this.noDataFoundFlag = false;\r\n                var temp = new Array(5);\r\n                if (from == \"received\" || from == \"veilbox\")\r\n                  temp[0] = alldata[index].from;\r\n                else if (from == \"sent\") temp[0] = alldata[index].to;\r\n                temp[1] = alldata[index].subject;\r\n                temp[2] = alldata[index].message;\r\n                temp[3] = index;\r\n                if (from == \"received\") temp[4] = \"received\";\r\n                else if (from == \"veilbox\") temp[4] = \"veilbox\";\r\n                else temp[4] = \"sent\";\r\n                this.params.data.push(temp);\r\n              }\r\n            });\r\n          }\r\n        },\r\n        errEmailsData => {\r\n          console.log(errEmailsData);\r\n        }\r\n      );\r\n    },\r\n    getData() {\r\n      this.getDataFromFirebase(\"received\");\r\n      this.getDataFromFirebase(\"sent\");\r\n      this.getDataFromFirebase(\"veilbox\");\r\n      if (this.params.data.length > 1) this.noDataFoundFlag = false;\r\n      else this.noDataFoundFlag = true;\r\n      this.printPresentTime();\r\n    },\r\n    printPresentTime() {\r\n      var today = new Date();\r\n      this.updateTime =\r\n        today.getHours() + \":\" + today.getMinutes() + \":\" + today.getSeconds();\r\n    },\r\n    onSelectionChange() {\r\n      if (this.$refs.table.getCheckedRowDatas(true).length > 1) {\r\n        this.selectMsgFlag = true;\r\n      } else {\r\n        this.selectMsgFlag = false;\r\n      }\r\n    },\r\n    delete_recover_SelectedMsg(flag) {\r\n      var received_emailObj = new Object();\r\n      var sent_emailObj = new Object();\r\n      var veilbox_emailObj = new Object();\r\n      var rec_dataFlag = false;\r\n      var sent_dataFlag = false;\r\n      var veil_dataFlag = false;\r\n      var val;\r\n      if (flag == \"delete\") val = null;\r\n      else if (flag == \"recover\") val = \"0\";\r\n      for (\r\n        var i = 1;\r\n        i < this.$refs.table.getCheckedRowDatas(true).length;\r\n        i++\r\n      ) {\r\n        var x;\r\n        if (this.$refs.table.getCheckedRowDatas(true)[i][4] == \"received\") {\r\n          x = this.$refs.table.getCheckedRowDatas(true)[i][3] + \"\";\r\n          if (val == \"0\") x += \"/bin\";\r\n          received_emailObj[x] = val;\r\n          rec_dataFlag = true;\r\n        } else if (this.$refs.table.getCheckedRowDatas(true)[i][4] == \"sent\") {\r\n          x = this.$refs.table.getCheckedRowDatas(true)[i][3] + \"\";\r\n          if (val == \"0\") x += \"/bin\";\r\n          sent_emailObj[x] = val;\r\n          sent_dataFlag = true;\r\n        } else if (\r\n          this.$refs.table.getCheckedRowDatas(true)[i][4] == \"veilbox\"\r\n        ) {\r\n          x = this.$refs.table.getCheckedRowDatas(true)[i][3] + \"\";\r\n          if (val == \"0\") x += \"/bin\";\r\n          veilbox_emailObj[x] = val;\r\n          veil_dataFlag = true;\r\n        }\r\n      }\r\n      for (i = 0; i < this.params.data.length; i++) {\r\n        if (rec_dataFlag && this.params.data[i][4] == \"received\") {\r\n          this.params.data.splice(i, 1);\r\n          i--;\r\n        } else if (sent_dataFlag && this.params.data[i][4] == \"sent\") {\r\n          this.params.data.splice(i, 1);\r\n          i--;\r\n        } else if (veil_dataFlag && this.params.data[i][4] == \"veilbox\") {\r\n          this.params.data.splice(i, 1);\r\n          i--;\r\n        }\r\n      }\r\n\r\n      var ref, userRef;\r\n      if (rec_dataFlag) {\r\n        ref = \"emails/\" + this.username + \"/received/\";\r\n        userRef = firebase.database().ref(ref);\r\n        userRef.update(received_emailObj).then(() => {\r\n          console.log(\"success received\");\r\n        });\r\n      }\r\n      if (sent_dataFlag) {\r\n        ref = \"emails/\" + this.username + \"/sent/\";\r\n        userRef = firebase.database().ref(ref);\r\n        userRef.update(sent_emailObj).then(() => {\r\n          console.log(\"success sent\");\r\n        });\r\n      }\r\n      if (veil_dataFlag) {\r\n        ref = \"emails/\" + this.username + \"/veilbox/\";\r\n        userRef = firebase.database().ref(ref);\r\n        userRef.update(veilbox_emailObj).then(() => {\r\n          console.log(\"success veilbox\");\r\n        });\r\n      }\r\n    },\r\n    deleteMsg() {\r\n      this.delete_recover_SelectedMsg(\"delete\");\r\n      this.printPresentTime();\r\n      this.selectMsgFlag = false;\r\n      document.getElementById(\"closebtn-delete-modal\").click();\r\n    },\r\n    recoverMsg() {\r\n      this.delete_recover_SelectedMsg(\"recover\");\r\n      this.printPresentTime();\r\n      this.selectMsgFlag = false;\r\n    }\r\n  },\r\n  created() {\r\n    this.email = firebase.auth().currentUser.email;\r\n    this.username = this.email.substring(0, this.email.length - 10);\r\n    this.getData();\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.eveilbtn {\r\n  padding: 5px 20px;\r\n}\r\n.msg-recover-btn {\r\n  right: 90px;\r\n}\r\n</style>"]}]}